# 一、聚集索引和二级索引

每个InnoDB表都有一个称为聚集索引的特殊索引，用于存储行数据。通常，聚集索引与主键同义。为了从查询、插入和其他数据库操作中获得最佳性能，了解InnoDB如何使用聚集索引来优化常见的查找和DML操作非常重要。

- 在表上定义主键时，InnoDB将其用作聚集索引。应该为每个表定义一个主键。如果没有逻辑唯一非空列或列集使来作为主键，请添加自动递增列。自动增量列值是唯一的，并在插入新行时自动添加。
- 如果没有为表定义主键，InnoDB将使用第一个唯一索引（所有键列都定义为not null）作为聚集索引。
- 如果表没有主键或合适的唯一索引，InnoDB会在包含行ID值的合成列上生成一个名为GEN_CLUST_INDEX的隐藏聚集索引。这些行按InnoDB分配的行ID排序。行ID是一个6字节的字段，随着新行的插入而单调增加。因此，按行ID排序的行在物理上是按插入顺序排列的。

## 聚集索引如何加速查询

通过聚集索引访问行非常快，因为索引搜索直接指向包含行数据的页面。如果表很大，则与使用与索引记录不同的页存储行数据的存储组织相比，聚集索引体系结构通常可以节省磁盘I/O操作。

## 二级索引与聚集索引的关系

与聚集索引不同的索引称为二级索引。在InnoDB中，二级索引中的每条记录都包含行主键列，以及为二级索引指定的列。InnoDB使用这个主键值来搜索聚集索引中的行。

如果主键很长，那么二级索引会占用更多的空间，所以主键较短是比较有利的。

# 二、概念解析

# B-Tree

# 索引页（Index Page）

> The default size of an index page is 16KB. The page      size is determined by the [`innodb_page_size`](https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_page_size) setting when the MySQL instance is initialized. 

# 聚集索引（clustered index）

InnoDB对主键索引的称呼。InnoDB表存储是根据主键列的值进行组织的，以加快涉及主键列的查询和排序。为了获得最佳性能，请根据对性能最关键的查询仔细选择主键列。因为修改聚集索引的列是一个昂贵的操作，所以选择很少或从不更新的主列。

在Oracle数据库产品中，这种类型的表称为索引组织表。

> 索引组织表实际上将所有数据都将以索引的形式存储。 

# 辅助索引（secondary index）

一种InnoDB索引，表示表列的一个子集。一个InnoDB表可以有0个、1个或多个二级索引。(与聚集索引形成对比，每个InnoDB表都需要聚集索引，它存储所有表列的数据。)

可以使用二级索引来满足只需要索引列中的值的查询。对于更复杂的查询，可以使用它来标识表中的相关行，然后通过使用聚集索引进行查找来检索这些行。

创建和删除二级索引通常会涉及大量的开销，因为要复制InnoDB表中的所有数据。对于InnoDB二级索引，快速创建索引特性使得CREATE index和DROP index语句都更快。

# 覆盖索引（covering index）

 包含查询检索到的所有列的索引。查询不使用索引值作为指针来查找完整的表行，而是从索引结构返回值，从而节省磁盘I/O。InnoDB可以将此优化技术应用于比MyISAM更多的索引，因为InnoDB辅助索引还包括主键列。在事务结束之前，InnoDB不能将此技术应用于针对事务修改的表的查询。 



