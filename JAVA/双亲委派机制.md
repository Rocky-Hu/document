# 1. 双亲委派机制有什么缺陷

无法向下委派，SPI接口类是jdk rt.jar包的类，它是由BootstrapClassLoader进行加载，而要加载java.sql.Driver的实现类，这个实现类是在classpath中，是由AppClassLoader加载器负责加载的。

DriverManager类由BootstrapClassLoader来加载，里面的逻辑要加载java.sql.Driver的实现，这个实现在第三方jar中，第三方jar包中的类由AppClassLoader来加载，也就是说BoostrapClassLoader需要委派AppClassLoader来加载类，这是违反双亲委派机制的，所以使用类作弊的方法，在线程中保存了AppClassLoader，然后加载的时候从线程中获取AppClassLoader，来加载第三方类。

> 没有显式的在调用 `ServiceLoader` 前设置线程上下文类加载器为 `AppClassLoader`，`ServiceLoader` 内部则获取当前线程上下文类加载器（这里为 AppClassLoader）来加载服务实现者的类

# 2. 如何打破双亲委派机制

方法1：重写loadClass方法，去掉父类加载部分

方法2：使用thread context loader

> `全盘负责`：即是当一个classloader加载一个Class的时候，这个Class所依赖的和引用的其它Class`通常`也由这个classloader负责载入

